@using ZauberCMS.Core
@implements ZauberCMS.Core.Sections.Interfaces.ISectionNav

<RadzenTree Data="@entries" Expand=@LoadFiles Style="width: 100%; height: 300px">
    <RadzenTreeLevel Text=@GetTextForNode Template=@FileOrFolderTemplate />
</RadzenTree>

@code {
    public void Dispose()
    {
        
    }

    public string Heading => "Media";
    public int SortOrder => 0;
    public string SectionAlias => Constants.Sections.MediaSection;
    
    IEnumerable<string> entries;
    protected override void OnInitialized()
    {
        var mediaDirectoryPath = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", "media");
        entries = Directory.GetDirectories(mediaDirectoryPath);
    }
    void LoadFiles(TreeExpandEventArgs args)
    {
        var directory = args.Value as string;
        args.Children.Data = Directory.GetDirectories(directory);
        args.Children.Text = GetTextForNode;
        args.Children.HasChildren = (path) => Directory.Exists((string)path);
        args.Children.Template = FileOrFolderTemplate;
    }
    string GetTextForNode(object data)
    {
        return Path.GetFileName((string)data);
    }
    RenderFragment<RadzenTreeItem> FileOrFolderTemplate = (context) => builder =>
    {
        string path = context.Value as string;
        bool isDirectory = Directory.Exists(path);
        builder.OpenComponent<RadzenIcon>(0);
        builder.AddAttribute(1, nameof(RadzenIcon.Icon), isDirectory ? "folder" : "insert_drive_file");
        builder.CloseComponent();
        builder.AddContent(3, context.Text);
    };
}
