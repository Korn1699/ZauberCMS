@using ZauberCMS.Core.Content.Commands
@using ZauberCMS.StarterSite.Layouts
@implements ZauberCMS.Core.Content.Interfaces.IContentView
@* This is the layout you want to use *@
@layout MainLayout

@* This is where you set Head/Meta information *@
<PageTitle>@(Content!.GetValue<string>("PageTitle"))</PageTitle>
<SectionContent SectionId="MainLayout.Sections.PageHeadContent">
    <meta name="description" content="@(Content!.GetValue<string>("MetaDescription"))">
</SectionContent>


@foreach (var blogPage in BlogPages)
{
    <p><a href="@($"/{blogPage.Url}")">@blogPage.Name</a></p>
}

@code {
    [Parameter] public Content? Content { get; set; }
    
    private List<Content> BlogPages { get; set; } = [];
    
    protected override async Task OnInitializedAsync()
    {
        var amountPerPage = Content!.GetValue<int>("AmountPerPage");
        var pages = await Mediator.Send(new QueryContentCommand
        {
            OrderBy = GetContentsOrderBy.DateCreated,
            AmountPerPage = amountPerPage,
            WhereClause = content => content.ParentId == Content!.Id 
        });
        BlogPages = pages.Items.ToList();
    }
}