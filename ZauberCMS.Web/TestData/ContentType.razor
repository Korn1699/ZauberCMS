@using System.Text
@using Microsoft.AspNetCore.Components.Forms

<EditForm Model="this" OnSubmit="HandleSubmit">
    @foreach (var property in Properties)
    {
        <DynamicContentProperty ComponentType="@property.ComponentType"
                                Value="@property.Value"
                                ValueChanged="@(value => UpdateProperty(property.Alias, value))" />
    }

    <button type="submit">Save</button>
</EditForm>

@((MarkupString)Text)

@code {
    [Parameter]
    public List<ContentPropertyData> Properties { get; set; } = new List<ContentPropertyData>();

    private string Text { get; set; } = string.Empty;
    
    private void UpdateProperty(string alias, string value)
    {
        var property = Properties.FirstOrDefault(p => p.Alias == alias);
        if (property != null)
        {
            property.Value = value;
        }
    }

    private void HandleSubmit()
    {
        var sb = new StringBuilder();
        sb.AppendLine("<p>Saving data:</p>");
        foreach (var property in Properties)
        {
            sb.AppendLine($"<p>{property.Alias}: {property.Value}</p>");
        }

        Text = sb.ToString();
    }
}